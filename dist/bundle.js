const e=new(window.AudioContext||window.webkitAudioContext);let t=!1,n=!0;const o=document.getElementById("audio-toggle");function r(){t||e.resume().then(()=>{t=!0})}function l(){if(!t||!n)return;const o=e.createOscillator(),r=e.createGain();o.type="sine",o.connect(r),r.connect(e.destination),r.gain.setValueAtTime(.4,e.currentTime),r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.7),o.frequency.setValueAtTime(400,e.currentTime),o.frequency.exponentialRampToValueAtTime(700,e.currentTime+.35),o.frequency.exponentialRampToValueAtTime(450,e.currentTime+.7),o.start(),o.stop(e.currentTime+.7)}function i(o=440,r=.05,l="square"){if(!t||!n)return;const i=e.createOscillator(),a=e.createGain();i.type=l,i.frequency.value=o,i.connect(a),a.connect(e.destination),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+r),i.start(),i.stop(e.currentTime+r)}o.addEventListener("click",()=>{n=!n,o.textContent=n?"ðŸ”Š":"ðŸ”‡",n&&r()}),window.addEventListener("keydown",r,{once:!0}),window.addEventListener("mousedown",r,{once:!0});const a=[[1,0,0,1,1,0,0,0],[1,0,1,1,1,1,0,0],[1,1,1,1,1,0,1,0],[1,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,0],[1,0,1,1,1,1,0,0],[1,0,0,1,1,0,0,0]],c=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0]],s=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],y=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],d=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,4,4,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,4,7,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,7,7,7,2,2,2,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,11,11,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,3,3,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,11,4,4,4,12,2,2,2,1,1,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,6,6,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,12,12,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,4,13,13,13,2,2,2,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,4,4,2,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,2,2,2,4,4,4,4,4,8,8,8,2,2,2,0,0,0,0,0,0,0,0,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[0,0,0,0,4,4,4,4,4,4,4,2,2,2,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,9,9,0,0,0,0,0,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],m=[c,s,y];let f=400,u=300,x=0,h=0,g=!1,p=null,w=0,M=0,T=0,v=!1,E=1,b=0;const k=3,S=.45,A=5,z=5,L=15,X=document.getElementById("stage"),Y=document.getElementById("game"),R=Y.getContext("2d");let W={x:100,y:75,speed:4},B={roomX:0,roomY:0,x:0,y:0,size:14,vx:0,vy:0,wanderTimer:0,wanderSpeed:.5,chaseSpeed:1.4,sight:140};function I(e,t){return Array.from({length:e},()=>Array.from({length:t},()=>({N:!0,S:!0,E:!0,W:!0})))}function N(){p=I(5,5);for(let e=0;e<5;e++)for(let t=0;t<5;t++)e+1<5&&Math.random()<S&&(p[e][t].E=!1,p[e+1][t].W=!1),t+1<5&&Math.random()<S&&(p[e][t].S=!1,p[e][t+1].N=!1);C()}function q(e,t){const n=[];return t>0&&p[e][t].N&&n.push({x:e,y:t-1}),t+1<5&&p[e][t].S&&n.push({x:e,y:t+1}),e+1<5&&p[e][t].E&&n.push({x:e+1,y:t}),e>0&&p[e][t].W&&n.push({x:e-1,y:t}),n}function V(e=0,t=0){const n=Array.from({length:5},()=>Array(5).fill(!1)),o=[{x:e,y:t}];for(n[e][t]=!0;o.length;){const{x:e,y:t}=o.shift();for(const r of q(e,t))n[r.x][r.y]||(n[r.x][r.y]=!0,o.push(r))}return n}function C(){for(;;){const e=V(0,0);let t=!0;for(let n=0;n<5;n++){for(let o=0;o<5;o++)if(!e[n][o]){t=!1;break}if(!t)break}if(t)return;let n=!1;for(let t=0;t<5&&!n;t++)for(let o=0;o<5&&!n;o++)if(e[t][o]){if(t+1<5&&!p[t][o].E&&!e[t+1][o]){p[t][o].E=!0,p[t+1][o].W=!0,n=!0;break}if(o+1<5&&!p[t][o].S&&!e[t][o+1]){p[t][o].S=!0,p[t][o+1].N=!0,n=!0;break}if(t>0&&!p[t][o].W&&!e[t-1][o]){p[t][o].W=!0,p[t-1][o].E=!0,n=!0;break}if(o>0&&!p[t][o].N&&!e[t][o-1]){p[t][o].N=!0,p[t][o-1].S=!0,n=!0;break}}if(!n)return}}const F=3*m[0][0].length,G=3*m[0].length,O=3*a[0].length,$=3*a.length;function U(e,t,n,{scale:o=3,flip:r=!1,colors:l={}}={}){for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][r?n[i].length-1-a:a];0!==c&&l[c]&&(R.fillStyle=l[c],R.fillRect(e+a*o,t+i*o,o,o))}}function D(e,t,n,o=!1){U(e,t,n,{scale:3,flip:o,colors:{1:"#000",2:"#FF0000"}})}function H(){Z.collected||x===Z.roomX&&h===Z.roomY&&U(Z.x,Z.y,a,{scale:3,colors:{1:"#4cf"}})}function P(e,t,n,{scale:o=3,flip:r=!1}={}){const l={1:"rgb(0,0,0)",2:"rgb(226,164,122)",3:"rgb(101,45,45)",4:"rgb(37,26,40)",5:"rgb(251,242,54)",6:"rgb(255,255,255)",7:"rgb(120,114,102)",8:"rgb(51,37,59)",9:"rgb(75,42,30)",10:"rgb(52,29,22)",11:"rgb(147,65,60)",12:"rgb(208,138,96)",13:"rgb(68,64,63)"};for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][r?n[i].length-1-a:a];0!==c&&(R.fillStyle=l[c],R.fillRect(e+a*o,t+i*o,o,o))}}function j(){ee.forEach(e=>{x===e.roomX&&h===e.roomY&&P(e.x,e.y,d,{scale:2,flip:!1})})}function J(){const e=p[x][h];R.lineWidth=8,R.strokeStyle="rgba(255, 0, 0, 0.6)",R.beginPath(),e.N||(R.moveTo(0,0),R.lineTo(f,0)),e.S||(R.moveTo(0,u),R.lineTo(f,u)),e.W||(R.moveTo(0,0),R.lineTo(0,u)),e.E||(R.moveTo(f,0),R.lineTo(f,u)),R.stroke()}function K(){le&&x===le.x&&h===le.y&&(R.strokeStyle="yellow",R.lineWidth=6,R.strokeRect(0,0,f,u))}function Q(){R.clearRect(0,0,f,u);const e=40*(x+5*h);R.fillStyle=`hsl(${e},50%,20%)`,R.fillRect(0,0,f,u),R.fillStyle="#ddd",R.font="12px monospace",R.fillText(`Fish: ${Z.collected?"âœ“":"âœ—"} â€¢ Level: ${E}`,10,16),H(),j(),K(),J(),D(W.x,W.y,m[w],v),T>0&&(T--,R.fillStyle="rgba(255,0,0,0.25)",R.fillRect(0,0,f,u)),b>0&&(b--,R.fillStyle="yellow",R.font="24px monospace",R.fillText("GET OUT!",f/2-50,u/2))}const Z={};function _(){Z.collected=!1,Z.roomX=Math.floor(5*Math.random()),Z.roomY=Math.floor(5*Math.random()),0===Z.roomX&&0===Z.roomY&&(Z.roomX<4?Z.roomX++:Z.roomY++),Z.x=Math.floor((f-O)/2),Z.y=Math.floor((u-$)/2)}_();const ee=[];function te(){const e={...B};do{e.roomX=Math.floor(5*Math.random()),e.roomY=Math.floor(5*Math.random())}while(0===e.roomX&&0===e.roomY);return e.x=Math.random()*(f-e.size),e.y=Math.random()*(u-e.size),e}ee.push(te());const ne={};function oe(){f=Math.floor(window.innerWidth/5),u=Math.floor(window.innerHeight/5),Y.width=f,Y.height=u;const e=f-F,t=u-G;W.x<0&&(W.x=0),W.y<0&&(W.y=0),W.x>e&&(W.x=e),W.y>t&&(W.y=t),ee.forEach(e=>{e.x=Math.max(0,Math.min(f-e.size,e.x)),e.y=Math.max(0,Math.min(u-e.size,e.y))}),Z.x=Math.max(0,Math.min(f-O,Z.x)),Z.y=Math.max(0,Math.min(u-$,Z.y)),re()}function re(){X.style.left=x*f+"px",X.style.top=h*u+"px"}addEventListener("keydown",e=>ne[e.key]=!0),addEventListener("keyup",e=>ne[e.key]=!1),window.addEventListener("resize",oe);let le=null;function ie(){const e=[];for(let t=0;t<5;t++)for(let n=0;n<5;n++)0!==t&&4!==t&&0!==n&&4!==n||t===Z.roomX&&n===Z.roomY||e.push({x:t,y:n});le=e[Math.random()*e.length|0]}function ae(e){if(x!==e.roomX||h!==e.roomY)return;const t=W.x+.5*F,n=W.y+.5*G,o=t-(e.x+.5*e.size),r=n-(e.y+.5*e.size),l=Math.hypot(o,r);if(l<e.sight){const t=e.chaseSpeed/(l||1);e.vx=o*t,e.vy=r*t}else if(e.wanderTimer<=0){const t=[-1,0,1];e.vx=t[3*Math.random()|0]*e.wanderSpeed,e.vy=t[3*Math.random()|0]*e.wanderSpeed,e.wanderTimer=60+(60*Math.random()|0)}else e.wanderTimer--;e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.x>f-e.size&&(e.x=f-e.size,e.vx*=-.5),e.y>u-e.size&&(e.y=u-e.size,e.vy*=-.5)}function ce(){return ee.some(e=>{if(x!==e.roomX||h!==e.roomY)return!1;const t=W.x,n=W.y,o=F,r=G,l=e.x,i=e.y,a=e.size,c=e.size;return!(l>t+o||l+a<t||i>n+r||i+c<n)})}function se(){let e=!1;ne.ArrowUp&&(W.y-=W.speed,e=!0),ne.ArrowDown&&(W.y+=W.speed,e=!0),ne.ArrowLeft&&(W.x-=W.speed,e=!0,v=!0),ne.ArrowRight&&(W.x+=W.speed,e=!0,v=!1);let t=!1;if(W.x<0&&(x>0&&p[x][h].W?(x--,W.x+=f,t=!0):W.x=0),W.x+F>f&&(x<4&&p[x][h].E?(x++,W.x-=f,t=!0):W.x=f-F),W.y<0&&(h>0&&p[x][h].N?(h--,W.y+=u,t=!0):W.y=0),W.y+G>u&&(h<4&&p[x][h].S?(h++,W.y-=u,t=!0):W.y=u-G),t&&re(),e?(M++,M>L&&(M=0,w=1===w?2:1),i(440+100*Math.random(),.05)):w=0,ee.forEach(ae),ce()&&(T=18,i(900,.08,"square"),pe("You were caught!",!1,!0),xe.disabled=!1,g=!0,W.x=Math.max(0,Math.min(f-F,.5*(f-F))),W.y=Math.max(0,Math.min(u-G,.5*(u-G)))),!Z.collected&&x===Z.roomX&&h===Z.roomY){const e={x:W.x,y:W.y,w:F,h:G},t={x:Z.x,y:Z.y,w:O,h:$};!(t.x>e.x+e.w||t.x+t.w<e.x||t.y>e.y+e.h||t.y+t.h<e.y)&&(Z.collected=!0,l(),ie(),b=60)}de()&&(pe("Next level!",!0,!1),he.disabled=!1)}function ye({sameLevel:e=!1}={}){x=0,h=0,W.x=Math.floor((f-F)/2),W.y=Math.floor((u-G)/2),re(),_(),le=null,e?(E=1,ee.length=0,ee.push(te())):(E++,ee.push(te())),N(),document.getElementById("next-level").disabled=!0,document.getElementById("modal").style.display="none"}function de(){return!(!le||!Z.collected)&&x===le.x&&h===le.y&&(0===le.x&&W.x<=0||4===le.x&&W.x+F>=f||0===le.y&&W.y<=0||4===le.y&&W.y+G>=u)}function me(){g||se(),Q(),requestAnimationFrame(me)}function fe(){oe(),re(),N(),me()}fe();const ue=document.getElementById("modal"),xe=document.getElementById("restart"),he=document.getElementById("next-level"),ge=document.getElementById("mtext");function pe(e="Game Over",t=!1,n=!0){ge.textContent=e,he.style.display=t?"inline-block":"none",xe.style.display=n?"inline-block":"none",ue.style.display="flex"}xe.addEventListener("click",()=>{ue.style.display="none",ye({sameLevel:!0}),g=!1}),he.addEventListener("click",()=>{ue.style.display="none",ye({sameLevel:!1})}),document.addEventListener("keydown",e=>{"Enter"===e.key&&("none"!==he.style.display?he.click():"none"!==xe.style.display&&xe.click(),ue.style.display="none")});