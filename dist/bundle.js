(()=>{var e=new(window.AudioContext||window.webkitAudioContext),t=!1,n=!0,o=document.getElementById("audio-toggle");function r(){t||e.resume().then(()=>{t=!0})}function l(o=440,r=.05,l="square"){if(!t||!n)return;const a=e.createOscillator(),i=e.createGain();a.type=l,a.frequency.value=o,a.connect(i),i.connect(e.destination),i.gain.setValueAtTime(.1,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+r),a.start(),a.stop(e.currentTime+r)}o.addEventListener("click",()=>{n=!n,o.textContent=n?"ðŸ”Š":"ðŸ”‡",n&&r()}),window.addEventListener("keydown",r,{once:!0}),window.addEventListener("mousedown",r,{once:!0});var a=[[1,0,0,1,1,0,0],[0,1,1,1,1,1,1],[0,1,1,1,1,1,0],[1,0,1,1,1,0,0]],i=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,4,4,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,4,7,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,7,7,7,2,2,2,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,11,11,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,3,3,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,11,4,4,4,12,2,2,2,1,1,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,6,6,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,12,12,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,4,13,13,13,2,2,2,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,4,4,2,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,2,2,2,4,4,4,4,4,8,8,8,2,2,2,0,0,0,0,0,0,0,0,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[0,0,0,0,4,4,4,4,4,4,4,2,2,2,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,9,9,0,0,0,0,0,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],m=[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]]],d=400,c=300,s=document.getElementById("stage"),y=document.getElementById("game"),f=y.getContext("2d"),h=m[0][0].length,x=m[0].length,u=3*h,g=3*x,p=3*a[0].length,v=3*a.length,M={x:100,y:75,speed:5},w=0,E=0,gamePaused=!1,T=null;function b(){T=Array.from({length:5},()=>Array.from({length:5},()=>({N:!0,S:!0,E:!0,W:!0})));for(let e=0;e<5;e++)for(let t=0;t<5;t++)e+1<5&&Math.random()<.45&&(T[e][t].E=!1,T[e+1][t].W=!1),t+1<5&&Math.random()<.45&&(T[e][t].S=!1,T[e][t+1].N=!1);!function(){for(;;){const e=S(0,0);let t=!0;for(let n=0;n<5;n++){for(let o=0;o<5;o++)if(!e[n][o]){t=!1;break}if(!t)break}if(t)return;let n=!1;for(let t=0;t<5&&!n;t++)for(let o=0;o<5&&!n;o++)if(e[t][o]){if(t+1<5&&!T[t][o].E&&!e[t+1][o]){T[t][o].E=!0,T[t+1][o].W=!0,n=!0;break}if(o+1<5&&!T[t][o].S&&!e[t][o+1]){T[t][o].S=!0,T[t][o+1].N=!0,n=!0;break}if(t>0&&!T[t][o].W&&!e[t-1][o]){T[t][o].W=!0,T[t-1][o].E=!0,n=!0;break}if(o>0&&!T[t][o].N&&!e[t][o-1]){T[t][o].N=!0,T[t][o-1].S=!0,n=!0;break}}if(!n)return}}()}function k(e,t){const n=[];return t>0&&T[e][t].N&&n.push({x:e,y:t-1}),t+1<5&&T[e][t].S&&n.push({x:e,y:t+1}),e+1<5&&T[e][t].E&&n.push({x:e+1,y:t}),e>0&&T[e][t].W&&n.push({x:e-1,y:t}),n}function S(e=0,t=0){const n=Array.from({length:5},()=>Array(5).fill(!1)),o=[{x:e,y:t}];for(n[e][t]=!0;o.length;){const{x:e,y:t}=o.shift();for(const r of k(e,t))n[r.x][r.y]||(n[r.x][r.y]=!0,o.push(r))}return n}var A={roomX:Math.floor(5*Math.random()),roomY:Math.floor(5*Math.random()),x:50+Math.random()*(d-100),y:50+Math.random()*(c-100),collected:!1},B=[];function I(){const e={roomX:0,roomY:0,x:0,y:0,size:14,vx:0,vy:0,wanderTimer:0,wanderSpeed:.5,chaseSpeed:1.2,sight:140};do{e.roomX=Math.floor(5*Math.random()),e.roomY=Math.floor(5*Math.random())}while(0===e.roomX&&0===e.roomY);return e.x=Math.random()*(d-e.size),e.y=Math.random()*(c-e.size),e}B.push(I());var z=0,L=0,W=0,R=!1,Y={};addEventListener("keydown",e=>Y[e.key]=!0),addEventListener("keyup",e=>Y[e.key]=!1);var X=0,N=0;function q(){d=Math.floor(window.innerWidth/5),c=Math.floor(window.innerHeight/5),y.width=d,y.height=c;const e=d-u,t=c-g;M.x<0&&(M.x=0),M.y<0&&(M.y=0),M.x>e&&(M.x=e),M.y>t&&(M.y=t),B.forEach(e=>{e.x=Math.max(0,Math.min(d-e.size,e.x)),e.y=Math.max(0,Math.min(c-e.size,e.y))}),A.x=Math.max(0,Math.min(d-p,A.x)),A.y=Math.max(0,Math.min(c-v,A.y)),V()}function V(){s.style.left=w*d+"px",s.style.top=E*c+"px"}window.addEventListener("resize",q);var $=null;function C(e,t,n,o={}){const{scale:r=3,flip:l=!1,colors:a={}}=o;for(let o=0;o<n.length;o++)for(let i=0;i<n[o].length;i++){const m=n[o][l?n[o].length-1-i:i];0!==m&&a[m]&&(f.fillStyle=a[m],f.fillRect(e+i*r,t+o*r,r,r))}}function F(e){if(w!==e.roomX||E!==e.roomY)return;const t=M.x+.5*u,n=M.y+.5*g,o=t-(e.x+.5*e.size),r=n-(e.y+.5*e.size),l=Math.hypot(o,r);if(l<e.sight){const t=e.chaseSpeed/(l||1);e.vx=o*t,e.vy=r*t}else if(e.wanderTimer<=0){const t=[-1,0,1];e.vx=t[3*Math.random()|0]*e.wanderSpeed,e.vy=t[3*Math.random()|0]*e.wanderSpeed,e.wanderTimer=60+(60*Math.random()|0)}else e.wanderTimer--;e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.x>d-e.size&&(e.x=d-e.size,e.vx*=-.5),e.y>c-e.size&&(e.y=c-e.size,e.vy*=-.5)}function G({resetWins:e=!1,sameLevel:t=!1}={}){e&&(X=0),t||X++,w=0,E=0,M.x=Math.floor((d-u)/2),M.y=Math.floor((c-g)/2),V(),A.collected=!1,A.roomX=Math.floor(5*Math.random()),A.roomY=Math.floor(5*Math.random()),A.x=50+Math.random()*(d-100),A.y=50+Math.random()*(c-100),$=null,t?(B.length=0,B.push(I())):B.push(I()),b(),gamePaused=!1,W=0,N=0,document.getElementById("next-level").disabled=!0,document.getElementById("game-over-modal").style.display="none"}function O(e="Game Over",t=!1,n=!0){const o=document.getElementById("game-over-modal"),r=document.getElementById("modal-text"),l=document.getElementById("next-level"),a=document.getElementById("restart");r&&(r.textContent=e),l&&(l.style.display=t?"inline-block":"none"),a&&(a.style.display=n?"inline-block":"none"),o.style.display="flex"}q(),V(),b(),function o(){gamePaused||function(){let o=!1;Y.ArrowUp&&(M.y-=M.speed,o=!0),Y.ArrowDown&&(M.y+=M.speed,o=!0),Y.ArrowLeft&&(M.x-=M.speed,o=!0,R=!0),Y.ArrowRight&&(M.x+=M.speed,o=!0,R=!1);let r=!1;if(M.x<0&&(w>0&&T[w][E].W?(w--,M.x+=d,r=!0):M.x=0),M.x+u>d&&(w<4&&T[w][E].E?(w++,M.x-=d,r=!0):M.x=d-u),M.y<0&&(E>0&&T[w][E].N?(E--,M.y+=c,r=!0):M.y=0),M.y+g>c&&(E<4&&T[w][E].S?(E++,M.y-=c,r=!0):M.y=c-g),r&&V(),o?(++L>15&&(L=0,z=1===z?2:1),l(440+100*Math.random(),.05)):z=0,M.y+=0,B.forEach(F),B.some(e=>{if(w!==e.roomX||E!==e.roomY)return!1;const t=M.x,n=M.y,o=u,r=g,l=e.x,a=e.y,i=e.size,m=e.size;return!(l>t+o||l+i<t||a>n+r||a+m<n)})&&(W=18,l(900,.08,"square"),document.getElementById("restart").disabled=!1,setTimeout(()=>{document.getElementById("game-over-modal").style.display="flex"},1e3),O("You were caught!",!1,!0),gamePaused=!0,M.x=Math.max(0,Math.min(d-u,.5*(d-u))),M.y=Math.max(0,Math.min(c-g,.5*(c-g)))),!A.collected&&w===A.roomX&&E===A.roomY){const o={x:M.x,y:M.y,w:u,h:g},r={x:A.x,y:A.y,w:p,h:v};!(r.x>o.x+o.w||r.x+r.w<o.x||r.y>o.y+o.h||r.y+r.h<o.y)&&(A.collected=!0,function(){if(!t||!n)return;const o=e.createOscillator(),r=e.createGain();o.type="sine",o.connect(r),r.connect(e.destination),r.gain.setValueAtTime(.4,e.currentTime),r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.7),o.frequency.setValueAtTime(400,e.currentTime),o.frequency.exponentialRampToValueAtTime(700,e.currentTime+.35),o.frequency.exponentialRampToValueAtTime(450,e.currentTime+.7),o.start(),o.stop(e.currentTime+.7)}(),function(){const e=[];for(let t=0;t<5;t++)for(let n=0;n<5;n++)0!==t&&4!==t&&0!==n&&4!==n||t===A.roomX&&n===A.roomY||e.push({x:t,y:n});$=e[Math.random()*e.length|0]}(),N=60)}!$||!A.collected||w!==$.x||E!==$.y||!(0===$.x&&M.x<=0||4===$.x&&M.x+u>=d||0===$.y&&M.y<=0||4===$.y&&M.y+g>=c)||(O("Next level!",!0,!1),document.getElementById("next-level").disabled=!1,document.getElementById("next-level").addEventListener("click",G))}(),function(){f.clearRect(0,0,d,c);const e=40*(w+5*E);f.fillStyle=`hsl(${e}, 50%, 20%)`,f.fillRect(0,0,d,c),f.fillStyle="#ddd",f.font="12px monospace",f.fillText(`Room: ${w},${E} â€¢ Enemies: ${B.length} â€¢ Fish: ${A.collected?"âœ“":"âœ—"} â€¢ Wins: ${X}`,10,16),A.collected||w===A.roomX&&E===A.roomY&&C(A.x,A.y,a,{scale:3,colors:{1:"#4cf"}}),B.forEach(e=>{w===e.roomX&&E===e.roomY&&function(e,t,n,o={}){const{scale:r=3,flip:l=!1}=o,a={1:"rgb(0, 0, 0)",2:"rgb(226, 164, 122)",3:"rgb(101, 45, 45)",4:"rgb(37, 26, 40)",5:"rgb(251, 242, 54)",6:"rgb(255, 255, 255)",7:"rgb(120, 114, 102)",8:"rgb(51, 37, 59)",9:"rgb(75, 42, 30)",10:"rgb(52, 29, 22)",11:"rgb(147, 65, 60)",12:"rgb(208, 138, 96)",13:"rgb(68, 64, 63)"};for(let o=0;o<n.length;o++)for(let i=0;i<n[o].length;i++){const m=n[o][l?n[o].length-1-i:i];0!==m&&(f.fillStyle=a[m],f.fillRect(e+i*r,t+o*r,r,r))}}(e.x,e.y,i,{scale:2,flip:!1})}),$&&w===$.x&&E===$.y&&(f.strokeStyle="yellow",f.lineWidth=6,f.strokeRect(0,0,d,c)),function(){const e=T[w][E];f.lineWidth=8,f.strokeStyle="rgba(255, 0, 0, 0.6)",f.beginPath(),e.N||(f.moveTo(0,0),f.lineTo(d,0)),e.S||(f.moveTo(0,c),f.lineTo(d,c)),e.W||(f.moveTo(0,0),f.lineTo(0,c)),e.E||(f.moveTo(d,0),f.lineTo(d,c)),f.stroke()}(),function(e,t,n,o=!1){C(e,t,n,{scale:3,flip:o,colors:{1:"#000",2:"#FF0000"}})}(M.x,M.y,m[z],R),W>0&&(W--,f.fillStyle="rgba(255,0,0,0.25)",f.fillRect(0,0,d,c)),N>0&&(N--,f.fillStyle="yellow",f.font="24px monospace",f.fillText("GET OUT!",d/2-50,c/2))}(),requestAnimationFrame(o)}(),document.getElementById("restart").addEventListener("click",()=>{document.getElementById("game-over-modal").style.display="none",G({sameLevel:!0})}),document.getElementById("next-level").addEventListener("click",()=>{document.getElementById("game-over-modal").style.display="none",G({sameLevel:!1})})})();