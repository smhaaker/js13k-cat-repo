const e=new(window.AudioContext||window.webkitAudioContext);let t=!1,n=!0;const o=document.getElementById("audio-toggle");function l(){t||e.resume().then(()=>{t=!0})}function r(){if(!t||!n)return;const o=e.createOscillator(),l=e.createGain();o.type="sine",o.connect(l),l.connect(e.destination),l.gain.setValueAtTime(.4,e.currentTime),l.gain.exponentialRampToValueAtTime(.001,e.currentTime+.7),o.frequency.setValueAtTime(400,e.currentTime),o.frequency.exponentialRampToValueAtTime(700,e.currentTime+.35),o.frequency.exponentialRampToValueAtTime(450,e.currentTime+.7),o.start(),o.stop(e.currentTime+.7)}function i(o=440,l=.05,r="square"){if(!t||!n)return;const i=e.createOscillator(),a=e.createGain();i.type=r,i.frequency.value=o,i.connect(a),a.connect(e.destination),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+l),i.start(),i.stop(e.currentTime+l)}o.addEventListener("click",()=>{n=!n,o.textContent=n?"ðŸ”Š":"ðŸ”‡",n&&l()}),window.addEventListener("keydown",l,{once:!0}),window.addEventListener("mousedown",l,{once:!0});const a=[[1,0,0,1,1,0,0,0],[1,0,1,1,1,1,0,0],[1,1,1,1,1,0,1,0],[1,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,0],[1,0,1,1,1,1,0,0],[1,0,0,1,1,0,0,0]],c=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0]],m=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],d=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0]],s=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,4,4,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,4,7,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,4,7,7,7,7,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,11,11,11,11,11,11,11,11,4,7,7,7,2,2,2,4,4,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,11,11,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,3,3,11,11,11,11,4,4,7,7,7,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,11,4,4,4,12,2,2,2,1,1,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,6,6,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,12,12,12,2,2,2,12,12,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,4,13,13,13,2,2,2,2,2,2,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,4,13,13,2,2,2,2,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,4,4,2,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,8,4,4,8,8,8,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,8,8,8,8,4,4,4,8,8,4,8,8,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,8,8,8,8,8,4,8,8,8,8,8,8,8,4,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,8,8,8,8,8,4,4,8,8,8,8,8,8,4,4,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,2,2,2,4,4,4,4,4,8,8,8,2,2,2,0,0,0,0,0,0,0,0,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[9,9,9,9,9,9,9,9,10,2,2,2,2,2,9,9,9,9,9,10,2,2,2,9,9,9,9,9,9,9,9,0],[0,0,0,0,4,4,4,4,4,4,4,2,2,2,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,9,9,9,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,9,9,0,0,0,0,0,10,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,10,10,10,10,0,0,0,10,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],y=[c,m,d];let f=400,u=300,h=0,x=0,g=!1,p=null,M=0,w=0,E=0,T=!1,v=0,b=0;const k=3,S=.45,A=5,B=5,I=15,z=document.getElementById("stage"),L=document.getElementById("game"),W=L.getContext("2d");let R={x:100,y:75,speed:5},Y={roomX:0,roomY:0,x:0,y:0,size:14,vx:0,vy:0,wanderTimer:0,wanderSpeed:.5,chaseSpeed:1.2,sight:140};function X(e,t){return Array.from({length:e},()=>Array.from({length:t},()=>({N:!0,S:!0,E:!0,W:!0})))}function N(){p=X(5,5);for(let e=0;e<5;e++)for(let t=0;t<5;t++)e+1<5&&Math.random()<S&&(p[e][t].E=!1,p[e+1][t].W=!1),t+1<5&&Math.random()<S&&(p[e][t].S=!1,p[e][t+1].N=!1);$()}function q(e,t){const n=[];return t>0&&p[e][t].N&&n.push({x:e,y:t-1}),t+1<5&&p[e][t].S&&n.push({x:e,y:t+1}),e+1<5&&p[e][t].E&&n.push({x:e+1,y:t}),e>0&&p[e][t].W&&n.push({x:e-1,y:t}),n}function V(e=0,t=0){const n=Array.from({length:5},()=>Array(5).fill(!1)),o=[{x:e,y:t}];for(n[e][t]=!0;o.length;){const{x:e,y:t}=o.shift();for(const l of q(e,t))n[l.x][l.y]||(n[l.x][l.y]=!0,o.push(l))}return n}function $(){for(;;){const e=V(0,0);let t=!0;for(let n=0;n<5;n++){for(let o=0;o<5;o++)if(!e[n][o]){t=!1;break}if(!t)break}if(t)return;let n=!1;for(let t=0;t<5&&!n;t++)for(let o=0;o<5&&!n;o++)if(e[t][o]){if(t+1<5&&!p[t][o].E&&!e[t+1][o]){p[t][o].E=!0,p[t+1][o].W=!0,n=!0;break}if(o+1<5&&!p[t][o].S&&!e[t][o+1]){p[t][o].S=!0,p[t][o+1].N=!0,n=!0;break}if(t>0&&!p[t][o].W&&!e[t-1][o]){p[t][o].W=!0,p[t-1][o].E=!0,n=!0;break}if(o>0&&!p[t][o].N&&!e[t][o-1]){p[t][o].N=!0,p[t][o-1].S=!0,n=!0;break}}if(!n)return}}const C=3*y[0][0].length,F=3*y[0].length,G=3*a[0].length,O=3*a.length;function U(e,t,n,{scale:o=3,flip:l=!1,colors:r={}}={}){for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][l?n[i].length-1-a:a];0!==c&&r[c]&&(W.fillStyle=r[c],W.fillRect(e+a*o,t+i*o,o,o))}}function D(e,t,n,o=!1){U(e,t,n,{scale:3,flip:o,colors:{1:"#000",2:"#FF0000"}})}function H(){Z.collected||h===Z.roomX&&x===Z.roomY&&U(Z.x,Z.y,a,{scale:3,colors:{1:"#4cf"}})}function P(e,t,n,{scale:o=3,flip:l=!1}={}){const r={1:"rgb(0,0,0)",2:"rgb(226,164,122)",3:"rgb(101,45,45)",4:"rgb(37,26,40)",5:"rgb(251,242,54)",6:"rgb(255,255,255)",7:"rgb(120,114,102)",8:"rgb(51,37,59)",9:"rgb(75,42,30)",10:"rgb(52,29,22)",11:"rgb(147,65,60)",12:"rgb(208,138,96)",13:"rgb(68,64,63)"};for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){const c=n[i][l?n[i].length-1-a:a];0!==c&&(W.fillStyle=r[c],W.fillRect(e+a*o,t+i*o,o,o))}}function j(){_.forEach(e=>{h===e.roomX&&x===e.roomY&&P(e.x,e.y,s,{scale:2,flip:!1})})}function J(){const e=p[h][x];W.lineWidth=8,W.strokeStyle="rgba(255, 0, 0, 0.6)",W.beginPath(),e.N||(W.moveTo(0,0),W.lineTo(f,0)),e.S||(W.moveTo(0,u),W.lineTo(f,u)),e.W||(W.moveTo(0,0),W.lineTo(0,u)),e.E||(W.moveTo(f,0),W.lineTo(f,u)),W.stroke()}function K(){le&&h===le.x&&x===le.y&&(W.strokeStyle="yellow",W.lineWidth=6,W.strokeRect(0,0,f,u))}function Q(){W.clearRect(0,0,f,u);const e=40*(h+5*x);W.fillStyle=`hsl(${e},50%,20%)`,W.fillRect(0,0,f,u),W.fillStyle="#ddd",W.font="12px monospace",W.fillText(`Room: ${h},${x} â€¢ Enemies: ${_.length} â€¢ Fish: ${Z.collected?"âœ“":"âœ—"} â€¢ Wins: ${v}`,10,16),H(),j(),K(),J(),D(R.x,R.y,y[M],T),E>0&&(E--,W.fillStyle="rgba(255,0,0,0.25)",W.fillRect(0,0,f,u)),b>0&&(b--,W.fillStyle="yellow",W.font="24px monospace",W.fillText("GET OUT!",f/2-50,u/2))}const Z={roomX:Math.floor(5*Math.random()),roomY:Math.floor(5*Math.random()),x:50+Math.random()*(f-100),y:50+Math.random()*(u-100),collected:!1},_=[];function ee(){const e={...Y};do{e.roomX=Math.floor(5*Math.random()),e.roomY=Math.floor(5*Math.random())}while(0===e.roomX&&0===e.roomY);return e.x=Math.random()*(f-e.size),e.y=Math.random()*(u-e.size),e}_.push(ee());const te={};function ne(){f=Math.floor(window.innerWidth/5),u=Math.floor(window.innerHeight/5),L.width=f,L.height=u;const e=f-C,t=u-F;R.x<0&&(R.x=0),R.y<0&&(R.y=0),R.x>e&&(R.x=e),R.y>t&&(R.y=t),_.forEach(e=>{e.x=Math.max(0,Math.min(f-e.size,e.x)),e.y=Math.max(0,Math.min(u-e.size,e.y))}),Z.x=Math.max(0,Math.min(f-G,Z.x)),Z.y=Math.max(0,Math.min(u-O,Z.y)),oe()}function oe(){z.style.left=h*f+"px",z.style.top=x*u+"px"}addEventListener("keydown",e=>te[e.key]=!0),addEventListener("keyup",e=>te[e.key]=!1),window.addEventListener("resize",ne);let le=null;function re(){const e=[];for(let t=0;t<5;t++)for(let n=0;n<5;n++)0!==t&&4!==t&&0!==n&&4!==n||t===Z.roomX&&n===Z.roomY||e.push({x:t,y:n});le=e[Math.random()*e.length|0]}function ie(e){if(h!==e.roomX||x!==e.roomY)return;const t=R.x+.5*C,n=R.y+.5*F,o=t-(e.x+.5*e.size),l=n-(e.y+.5*e.size),r=Math.hypot(o,l);if(r<e.sight){const t=e.chaseSpeed/(r||1);e.vx=o*t,e.vy=l*t}else if(e.wanderTimer<=0){const t=[-1,0,1];e.vx=t[3*Math.random()|0]*e.wanderSpeed,e.vy=t[3*Math.random()|0]*e.wanderSpeed,e.wanderTimer=60+(60*Math.random()|0)}else e.wanderTimer--;e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.x>f-e.size&&(e.x=f-e.size,e.vx*=-.5),e.y>u-e.size&&(e.y=u-e.size,e.vy*=-.5)}function ae(){return _.some(e=>{if(h!==e.roomX||x!==e.roomY)return!1;const t=R.x,n=R.y,o=C,l=F,r=e.x,i=e.y,a=e.size,c=e.size;return!(r>t+o||r+a<t||i>n+l||i+c<n)})}function ce(){let e=!1;te.ArrowUp&&(R.y-=R.speed,e=!0),te.ArrowDown&&(R.y+=R.speed,e=!0),te.ArrowLeft&&(R.x-=R.speed,e=!0,T=!0),te.ArrowRight&&(R.x+=R.speed,e=!0,T=!1);let t=!1;if(R.x<0&&(h>0&&p[h][x].W?(h--,R.x+=f,t=!0):R.x=0),R.x+C>f&&(h<4&&p[h][x].E?(h++,R.x-=f,t=!0):R.x=f-C),R.y<0&&(x>0&&p[h][x].N?(x--,R.y+=u,t=!0):R.y=0),R.y+F>u&&(x<4&&p[h][x].S?(x++,R.y-=u,t=!0):R.y=u-F),t&&oe(),e?(w++,w>I&&(w=0,M=1===M?2:1),i(440+100*Math.random(),.05)):M=0,_.forEach(ie),ae()&&(E=18,i(900,.08,"square"),document.getElementById("restart").disabled=!1,setTimeout(()=>{document.getElementById("modal").style.display="flex"},1e3),fe("You were caught!",!1,!0),g=!0,R.x=Math.max(0,Math.min(f-C,.5*(f-C))),R.y=Math.max(0,Math.min(u-F,.5*(u-F)))),!Z.collected&&h===Z.roomX&&x===Z.roomY){const e={x:R.x,y:R.y,w:C,h:F},t={x:Z.x,y:Z.y,w:G,h:O};!(t.x>e.x+e.w||t.x+t.w<e.x||t.y>e.y+e.h||t.y+t.h<e.y)&&(Z.collected=!0,r(),re(),b=60)}de()&&(fe("Next level!",!0,!1),document.getElementById("next-level").disabled=!1,document.getElementById("next-level").addEventListener("click",me))}function me({resetWins:e=!1,sameLevel:t=!1}={}){e&&(v=0),t||v++,h=0,x=0,R.x=Math.floor((f-C)/2),R.y=Math.floor((u-F)/2),oe(),Z.collected=!1,Z.roomX=Math.floor(5*Math.random()),Z.roomY=Math.floor(5*Math.random()),Z.x=50+Math.random()*(f-100),Z.y=50+Math.random()*(u-100),le=null,t?(_.length=0,_.push(ee())):_.push(ee()),N(),document.getElementById("next-level").disabled=!0,document.getElementById("modal").style.display="none"}function de(){return!(!le||!Z.collected)&&h===le.x&&x===le.y&&(0===le.x&&R.x<=0||4===le.x&&R.x+C>=f||0===le.y&&R.y<=0||4===le.y&&R.y+F>=u)}function se(){g||ce(),Q(),requestAnimationFrame(se)}function ye(){ne(),oe(),N(),se()}function fe(e="Game Over",t=!1,n=!0){const o=document.getElementById("modal"),l=document.getElementById("mtext"),r=document.getElementById("next-level"),i=document.getElementById("restart");l&&(l.textContent=e),r&&(r.style.display=t?"inline-block":"none"),i&&(i.style.display=n?"inline-block":"none"),o.style.display="flex"}ye(),document.getElementById("restart").addEventListener("click",()=>{document.getElementById("modal").style.display="none",me({sameLevel:!0}),g=!1}),document.getElementById("next-level").addEventListener("click",()=>{document.getElementById("modal").style.display="none",me({sameLevel:!1})});